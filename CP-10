from addons.string_utils import StringUtils
from distutils.util import strtobool
from selenium.webdriver.common.by import By
from src.testproject.classes import DriverStepSettings, StepSettings
from src.testproject.decorator import report_assertion_errors
from src.testproject.enums import SleepTimingType
from src.testproject.sdk.drivers import webdriver
import pytest


"""
This pytest test was automatically generated by TestProject
    Project: My first Project
    Package: TestProject.Generated.Tests.MyFirstProject
    Test: CP-10
    Generated by: Brayan Zea (bnzea20@ucatolica.edu.co)
    Generated on 04/25/2021, 16:19:05
"""


@pytest.fixture()
def driver():
    driver = webdriver.Chrome(token="bN_GwVJj5KVPXz7LrMDWs1HYIuZFcb-QKck1Zz0jMjY",
                              project_name="My first Project",
                              job_name="CP-10")
    step_settings = StepSettings(timeout=15000,
                                 sleep_time=500,
                                 sleep_timing_type=SleepTimingType.Before)
    with DriverStepSettings(driver, step_settings):
        yield driver
    driver.quit()


@report_assertion_errors
def test_main(driver):
    """El sistema debe permitir validar el correo a la hora de actualizar los datos del usuario para permitir un buen manejo de la información para hacer una buena verificación del correo electrónico, porque en algunos casos no aparecerá el símbolo arroba y la actualización no debe ser válida."""
    # Test Parameters
    # Auto generated application URL parameter
    ApplicationURL = "https://idiv-cloud.webcindario.com/index.php"

    # 1. Navigate to '{ApplicationURL}'
    # Navigates the specified URL (Auto-generated)
    driver.get(f'{ApplicationURL}')

    # 2. Click 'Iniciar Sesion'
    iniciar_sesion = driver.find_element(By.XPATH,
                                         "//span[. = 'Iniciar Sesion']")
    iniciar_sesion.click()

    # 3. Click 'login_nickname_usuario'
    login_nickname_usuario = driver.find_element(By.CSS_SELECTOR,
                                                 "#login_nickname_usuario")
    login_nickname_usuario.click()

    # 4. Type 'brayan_zea' in 'login_nickname_usuario'
    login_nickname_usuario = driver.find_element(By.CSS_SELECTOR,
                                                 "#login_nickname_usuario")
    login_nickname_usuario.send_keys("brayan_zea")

    # 5. Click 'INPUT'
    input = driver.find_element(By.XPATH,
                                "//i/input")
    input.click()

    # 6. Click 'I'
    i = driver.find_element(By.XPATH,
                            "//td[5]//i")
    i.click()

    # 7. Click 'update_correo_usuario'
    update_correo_usuario = driver.find_element(By.CSS_SELECTOR,
                                                "#update_correo_usuario")
    update_correo_usuario.click()

    # 8. Type 'bnzea20ucatolica.edu.co' in 'update_correo_usuario'
    update_correo_usuario = driver.find_element(By.CSS_SELECTOR,
                                                "#update_correo_usuario")
    update_correo_usuario.send_keys("bnzea20ucatolica.edu.co")

    # 9. Click 'Guardar Cambios'
    guardar_cambios = driver.find_element(By.XPATH,
                                          "//button[. = 'Guardar Cambios']")
    guardar_cambios.click()

    # 10. Compares 'Correo incorrecto' with 'IDIV CLOUD'
    step_output = driver.addons().execute(
        StringUtils.comparetwostrings(
            firstString="Correo incorrecto",
            secondString="IDIV CLOUD",
            ignoreCase=False,
            expectedResult=0))
